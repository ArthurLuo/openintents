<?xml version="1.0" ?>
<project name="OpenIntents-Release" default="help">
		
	<!-- Read version number from file -->
	<property file="build-version.txt" />
	
	<!-- release dir: this is where all the completed files go -->
	<property name="release-dir" value="release" />
	<property name="binary-dir" value="${release-dir}/openintents-binary-${build-version}" />
	<property name="source-dir" value="${release-dir}/openintents-source-${build-version}" />
	<property name="binary-lib-dir" value="${binary-dir}/lib" />
	<property name="binary-samples-dir" value="${binary-dir}/samples" />
					
	<!-- (sub)project folders  -->
	<property name="base-dir" value="." />
	<property name="news-dir" value="../samples/newsreader" />
	<property name="locations-dir" value="../samples/FavoriteLocations" />
	<property name="presentpicker-dir" value="../samples/PresentPicker" />

	<!-- standard lib file -->
	<property name="binary-lib-file" value="${binary-lib-dir}/openintents-lib.jar" />
		
	<target
		name="help"
		>
		<echo>----------openintents.org buildscript v0.0.1</echo>
		<echo>use release.$domainname to compile domainname</echo>
		<echo>use release.appname to comile appname</echo>
		<echo>use release for a full openintents release</echo>

	</target>

	<!-- delete release directory and set up structure -->
	<target name="setup.dirs">
		<delete dir="${release-dir}"/>
		<mkdir dir="${release-dir}"/>
		<mkdir dir="${binary-dir}"/>
		<mkdir dir="${binary-lib-dir}"/>
		<mkdir dir="${binary-samples-dir}"/>
		<mkdir dir="${source-dir}"/>
		
		<!-- Now copy global readme files -->
		<copy 
			file="readme_OpenIntents.txt" 
			todir="${binary-dir}" />
		<copy 
			file="../readme_binary.txt" 
			tofile="${binary-dir}/readme.txt" />
		<copy 
			file="../readme_source.txt" 
			tofile="${source-dir}/readme.txt" />

		<!-- Copy the source files -->
		<copy todir="${source-dir}/openintents">
		    <fileset dir=".">
		    	<exclude name="**/bin/**" />
	    		<exclude name="**/release/**" />
	    		<exclude name="**/.svn" />
		    </fileset>
		</copy>
	</target>

	<target 
		name="OpenIntents"		
		depends="setup.dirs"
		>
		<echo>------------------------------OpenIntents + lib----------------------</echo>
		<ant
			dir="${base-dir}"
			antfile="build.xml"
			target="lib"
		/>
		<copy
			file="${base-dir}/bin/openintents.apk"
			todir="${binary-dir}"
			/>
		<copy
			file="${base-dir}/bin/openintents-lib.jar"
			tofile="${binary-lib-file}"
			/>
		<copy
			file="${base-dir}/bin/openintents-lib.jar"
			todir="${source-lib-dir}"
			/>

			
	</target>

	<target name="News"
		depends="OpenIntents"
		>
		<echo>------------------------------news.package----------------------</echo>
		<ant
			dir="${news-root}"
			antfile="openintents-news.xml"
			target="package"
		>
			<property name="openintents-jar" value="${release-jar}" />
		</ant>
		<copy
			file="${news-root}/bin/OpenIntents Newsreader.apk"
			todir="${release-dir}"
			/>

	</target>


	<target name="FavoriteLocations"
		depends="OpenIntents"
		>
		<echo>------------------------------locations.package----------------------</echo>
		<ant
			dir="${locations-root}"
			antfile="openintents-locations.xml"
			target="package"
			>
			<property name="openintents-jar" value="${release-jar}" />
		</ant>
		<copy
			file="${locations-root}/bin/OpenIntents-favoriteLocations.apk"
			todir="${release-dir}"
			/>

	</target>

	<target name="PresentPicker"
		depends="OpenIntents"
		>
		<echo>------------------------------PresentPicker----------------------</echo>
		<!-- Use most recent lib file -->
		<mkdir dir="${presentpicker-dir}/lib"/>
		<copy
			file="${binary-lib-file}"
			todir="${presentpicker-dir}/lib"
			/>
		<!-- Compile -->
		<ant
			dir="${presentpicker-dir}"
			antfile="build.xml"
			target="package"
			>
		</ant>
		<!-- Copy to binary release -->
		<copy todir="${binary-samples-dir}">
			<fileset>
				<include name="${presentpicker-dir}/bin/PresentPicker.apk" />
				<include name="${presentpicker-dir}/readme_PresentPicker.txt" />				
			</fileset>
		</copy>
		<!-- Copy to source release -->
		<copy todir="${source-dir}/PresentPicker">
		    <fileset dir="${presentpicker-dir}">
		    	<exclude name="**/bin/**" />
	    		<exclude name="**/.svn" />
		    </fileset>
		</copy>
	</target>	

	<target
		name="release"		
		depends="PresentPicker"
		>
	</target>
	
	<target 
		name="release-zip"
		depends="release">
		<zip
			destfile="${binary-dir}.zip"
			basedir="${binary-dir}"
			/>
		<zip
			destfile="${source-dir}.zip"
			basedir="${source-dir}"
			/>
	</target>
</project>
